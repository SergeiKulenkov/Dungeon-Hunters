using UnityEngine;
using System.Collections;

public class InvulnerabilityController : MonoBehaviour
{
    ///////////////////////////////////////////
    // Fields
    private SpriteRenderer spriteRenderer;
    private Color color;

    public bool IsActive { get; private set; }
    public int NumberOfFlashes { get; private set; }
    public float IFramesTimer { get; private set; }

    ///////////////////////////////////////////
    // Methods

    private void Awake()
    {
        spriteRenderer = GetComponent<SpriteRenderer>();
        color = spriteRenderer.color;
    }

    public void SetNumberOfFlashes(int number) => NumberOfFlashes = number;
    public void SetFramesTimer(float timer) => IFramesTimer = timer;

    public void StartInvulnerability()
    {
        StartCoroutine(Invulnerability());
    }

    private IEnumerator Invulnerability()
    {
        IsActive = true;
        WaitForSeconds timeBetweenFlashes = new WaitForSeconds(IFramesTimer / (NumberOfFlashes * 2));

        for (int i = 0; i < NumberOfFlashes; i++)
        {
            if (color.r >= 1 / 200 && color.g <= 1/50 && color.b <= 50)
            {
                spriteRenderer.color = new Color(1, 1, 0, 1f);
            }
            else
            {
                spriteRenderer.color = new Color(1, 0, 0, 0.5f);
            }
            yield return timeBetweenFlashes;
            spriteRenderer.color = color;
            yield return timeBetweenFlashes;
        }
        IsActive = false;
    }
}
